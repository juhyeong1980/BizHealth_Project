<!-- Removed Action Bar -->

<div id="recPanel" class="rec-panel">
    <div class="rec-header"><strong>💡 추천 병합</strong>
        <div><button onclick="applyAllRecs()"
                style="background:#27ae60; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; font-weight:bold;">⚡
                모두 병합 적용</button><button onclick="closeRec()"
                style="border:none; background:none; cursor:pointer; font-size:16px; margin-left:10px;">&times;</button>
        </div>
    </div>
    <div id="recGrid" class="rec-grid"></div>
</div>
<h2>⚙️ 설정</h2>

<div
    style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #ddd; padding-bottom:10px; margin-top:20px; margin-bottom:15px;">
    <h3 style="margin:0;">1. 데이터 정리 (사업장명 표준화)</h3>
    <button class="btn-commit" onclick="saveConfigAndRefresh()"><i class="fas fa-save"></i> 설정 저장</button>
</div>

<!-- Manual Merge / Dropdown Interface -->


<!-- Existing Mappings Table -->
<div
    style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px;">
    <h4 style="margin-top:0; color:#2c3e50; border-bottom:1px solid #eee; padding-bottom:10px;">📋 병합 목록</h4>
    <div style="max-height: 300px; overflow-y: auto;">
        <table style="width:100%; border-collapse: collapse; font-size:13px;">
            <thead style="position: sticky; top: 0; background: #f8f9fa;">
                <tr>
                    <th style="padding:10px; border-bottom:2px solid #ddd; text-align:left;">대표 사업장명</th>
                    <th style="padding:10px; border-bottom:2px solid #ddd; text-align:left;">병합 사업장명 (원본)</th>
                    <th style="padding:10px; border-bottom:2px solid #ddd; text-align:center;">관리</th>
                </tr>
            </thead>
            <tbody id="mapping-table-body">
                <tr>
                    <td colspan="3" style="text-align:center; padding:20px; color:#999;">로딩 중...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="dd-container" style="margin-bottom: 40px;">
    <div class="dd-col source">
        <div class="dd-header">📂 미분류 (<span id="srcCnt">0</span>)</div><input type="text" class="dd-search"
            placeholder="검색..." onkeyup="filterList('sourceList', this.value)">
        <div id="sourceList" class="dd-list"></div>
    </div>
    <div class="dd-col groups" style="flex:1.2;">
        <div class="dd-header"><span>🔗 병합 그룹</span><button onclick="openGroupModal()"
                style="border:none; background:#3498db; color:white; border-radius:3px; padding:2px 8px; cursor:pointer;">+</button>
        </div>
        <input type="text" class="dd-search" placeholder="그룹 검색..." onkeyup="filterGroups(this.value)">
        <div id="newGroupZone"
            style="border:2px dashed #3498db; padding:15px; border-radius:8px; margin-bottom:15px; text-align:center; color:#3498db; font-weight:bold; background:#eaf6fd;">
            + 여기에 드래그하여 새 그룹 생성</div>
        <div id="groupContainer" class="dd-list" style="border:none; background:none; padding:0;"></div>
    </div>
    <div class="dd-col exclude">
        <div class="dd-header">🚫 제외 목록</div>
        <div style="position:relative; margin-bottom:10px;"><input type="text" id="quickExcludeInput" class="dd-search"
                placeholder="검색하여 제외..." onkeyup="filterQuickExclude()">
            <div id="quickExcludeDropdown" class="search-dropdown"></div>
        </div>
        <div id="excludeList" class="dd-list"></div>
    </div>
</div>
<hr style="border:0; border-top:2px dashed #ccc; margin: 40px 0;">

<!-- Exam Type Configuration Section -->
<div
    style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #ddd; padding-bottom:10px; margin-top:0; margin-bottom:20px;">
    <h3 style="margin:0;">2. 검진종류 분류</h3>
    <button class="btn-commit"><i class="fas fa-save"></i> 설정 저장</button>
</div>
<div
    style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px;">
    <p style="color: #666; font-size: 13px; margin-bottom: 15px;">
        우선순위를 조정하려면 항목을 드래그하세요. 위쪽에 있을수록 먼저 적용됩니다.<br>
        키워드는 DB에 존재하는 '검진종류' 값에서 선택할 수 있습니다.
    </p>

    <div id="examRuleContainer" class="dd-list" style="min-height:100px;"></div>
</div>

<!-- Keyword Selection Modal -->
<div id="keywordModal" class="modal-overlay"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:center;">
    <div
        style="background:white; padding:20px; border-radius:8px; width:300px; max-width:90%; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
        <h4 style="margin-top:0; margin-bottom:10px;">키워드 선택</h4>
        <div id="keywordCheckList"
            style="max-height:250px; overflow-y:auto; border:1px solid #eee; padding:10px; margin-bottom:15px; background:#f9f9f9;">
        </div>
        <div style="display:flex; justify-content:flex-end; gap:5px;">
            <button onclick="closeKeywordModal()"
                style="border:1px solid #ddd; background:white; padding:6px 12px; border-radius:4px; cursor:pointer;">취소</button>
            <button onclick="applyKeywords()"
                style="border:none; background:var(--accent); color:white; padding:6px 15px; border-radius:4px; cursor:pointer;">적용</button>
        </div>
    </div>
</div>

<hr style="border:0; border-top:2px dashed #ccc; margin: 40px 0;">
<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
    <h3 style="margin:0; border-bottom:2px solid #ddd; padding-bottom:10px; flex:1;">3. 코드 표준 관리</h3><label><input
            type="checkbox" id="cc-filter-used" onchange="CodeCheckApp.render()"> 사용된 코드만 보기</label>
</div>
<div class="cc-control-panel">
    <div class="cc-upload-box"><label style="font-weight:bold; margin-bottom:10px;">1. 기준 코드 (code.csv)</label><input
            type="file" id="cc-file-master" accept=".csv"><span class="cc-status-badge" id="cc-status-master">대기</span>
    </div>
    <div class="cc-upload-box"><label style="font-weight:bold; margin-bottom:10px;">2. 사용 내역
            (2025code.csv)</label><input type="file" id="cc-file-target" accept=".csv"><span class="cc-status-badge"
            id="cc-status-target">대기</span></div>
</div>
<div id="cc-stats-display" style="font-weight:bold; margin-bottom:10px;"></div>
<div style="overflow-x:auto; max-height: 500px; border:1px solid #eee;">
    <table id="cc-result-table">
        <thead>
            <tr>
                <th width="50">상태</th>
                <th class="text-left">코드</th>
                <th class="text-left">명칭</th>
                <th class="text-left">검진종류</th>
                <th>금액</th>
                <th>비고</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="6" style="text-align: center; color: #aaa;">데이터 없음</td>
            </tr>
        </tbody>
    </table>
</div>